<project name="tkl_tests">
    <property name="cli_repo_path" value="/Users/antonio/repos/tackle-test-generator-cli" />
    <property name="app" value="1_tullibee" />
    <property name="testsuite" value="evosuite" />
    <property name="class" value="com.ib.client.AnyWrapperMsgGenerator" />

    <taskdef uri="antlib:org.jacoco.ant" resource="org/jacoco/ant/antlib.xml">
        <classpath path="${cli_repo_path}/experiment/lib/download/org.jacoco.ant-0.8.7-nodeps.jar" />
    </taskdef>

    <path id="classpath">
        <pathelement location="${cli_repo_path}/experiment/lib/acts_3.2.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/javaparser-symbol-solver-core-3.16.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/commons-logging-1.2.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/FastInfoset-1.2.15.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/jackson-core-2.12.5.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/jsr305-1.3.9.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/javax.json-1.0.4.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/istack-commons-runtime-3.0.7.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/javax.annotation-api-1.3.2.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/heros-1.2.0.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/evosuite-standalone-runtime-1.0.7.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/jaxb-runtime-2.4.0-b180830.0438.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/javax.activation-api-1.2.0.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/asm-util-7.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/slf4j-api-1.7.5.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/junit-4.13.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/functionaljava-4.2.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/polyglot-2006.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/org.jacoco.agent-0.8.7.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/java_cup-0.9.2.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/failureaccess-1.0.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/checker-qual-2.11.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/randoop-all-4.2.6.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/evosuite-master-1.0.7.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/replacecall-4.2.6.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/org.jacoco.ant-0.8.7-nodeps.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/commons-cli-1.4.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/error_prone_annotations-2.3.4.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/guava-29.0-jre.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/asm-7.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/txw2-2.4.0-b180830.0438.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/hamcrest-all-1.3.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/asm-commons-7.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/stax-ex-1.8.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/commons-codec-1.11.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/javaparser-core-3.16.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/commons-io-2.6.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/jaxb-api-2.4.0-b180725.0427.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/dexlib2-2.4.0.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/org.jacoco.report-0.8.7.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/soot-4.1.0.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/asm-tree-7.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/xmlpull-1.1.3.4d_b4_min.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/hamcrest-core-1.3.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/jasmin-3.0.2.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/j2objc-annotations-1.3.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/axml-2.0.0.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/asm-analysis-7.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/jackson-annotations-2.12.5.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/jackson-databind-2.12.5.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/httpcore-4.4.6.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/httpclient-4.5.13.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/org.jacoco.core-0.8.7.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/tackle-test-generator-core-1.0.0-SNAPSHOT.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/javassist-3.27.0-GA.jar" />
        <pathelement location="${cli_repo_path}/experiment/tkltest-output-${app}/${app}-instrumented-classes" />
    </path>

    <path id="all">
        <path refid="classpath" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/junit-4.13.1.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/hamcrest-all-1.3.jar" />
        <pathelement location="${cli_repo_path}/experiment/lib/download/hamcrest-core-1.3.jar" />
        <pathelement location="${cli_repo_path}/experiment/tkltest-output-${app}/${app}-${testsuite}-tests" />
    </path>

    <macrodef name="replaceproperty" taskname="@{taskname}">
        <attribute name="src" />
        <attribute name="dest" default="" />
        <attribute name="replace" default="" />
        <attribute name="with" default="" />
        <sequential>
            <loadresource property="@{dest}">
                <propertyresource name="@{src}" />
                <filterchain>
                    <tokenfilter>
                        <filetokenizer/>
                        <replacestring from="@{replace}" to="@{with}"/>
                    </tokenfilter>
                </filterchain>
            </loadresource>
        </sequential>
    </macrodef>

    <replaceproperty src="class" dest="class_underlined" replace="." with="_" />
    <replaceproperty src="class" dest="class_slashed" replace="." with="/" />

    <target name="execute-tests">
        <!-- <mkdir dir="${cli_repo_path}/experiment/tkltest-output-${app}/${app}-tkltest-reports/junit-reports/${app}-${testsuite}-tests/raw" /> -->
        <jacoco:coverage destfile="${class_underlined}_jacoco.exec" includes="${class}" xmlns:jacoco="antlib:org.jacoco.ant">
            <junit printsummary="on" haltonfailure="no" fork="true" forkmode="once" showoutput="yes">
                <classpath refid="all" />
                <batchtest todir="${cli_repo_path}/experiment/tkltest-output-${app}/${app}-tkltest-reports/junit-reports/${app}-${testsuite}-tests/raw">
                    <fileset dir="${cli_repo_path}/experiment/tkltest-output-${app}/${app}-${testsuite}-tests" includes="**/${class_slashed}*.class" excludes="**/*ESTest_scaffolding.class" />
                </batchtest>
                <formatter type="xml" />
            </junit>
        </jacoco:coverage>
    </target>
</project>
